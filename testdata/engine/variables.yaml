---
  meta:
    author: jptosso
    description: Test if the variables work
    enabled: true
    name: variables.yaml
  tests:
  -
    test_title: variables
    stages:
    -
      stage:
        input:
            uri: /index.php?t1=aaa&t2=bbb&t3=ccc&a=test
            method: "POST"
            headers:
                content-type: application/xml
                CookIe: phpmyadminphp=test
            data: "text"
        output:
          triggered_rules:
            - 1
            - 1234
            #- 2
            - 15
            - 110
            - 200
            - 300
            - 400
            - 10
          non_triggered_rules:
            
  rules: |
    SecRule REQBODY_PROCESSOR "" "id: 10, log"
    SecRequestBodyAccess On
    SecDebugLogLevel 5
    SecRule ARGS:/^t1$/ "aaa" "id:1,phase:1,block,log"
    SecRule &ARGS_GET:/t.*/ "@gt 2" "id: 1234, phase:1, block, log"
    SecRule REQUEST_METHOD "POST" "id:15, log"
    SecAction "id:100,setvar:'tx.test=%{REQUEST_METHOD}'"
    SecRule TX:test "POST" "id:110,log"

    SecAction "id:130,setvar:'tx.allowed_methods=GET HEAD OPTIONS'"
    SecRule REQUEST_METHOD "!@within %{tx.allowed_methods}" "id:200,log"

    SecRule REQUEST_COOKIES:pHpMyAdmInPhp "test" "id:300,phase:1,block,log"
    SecRule ARGS_GET_NAMES "t1" "id:400,log"