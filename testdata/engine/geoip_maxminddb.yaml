---
  meta:
    author: Xinyu Wu
    description: This is a mix of many tests used to check geoip maxminddb engine.
    enabled: true
    name: geoip_maxminddb.yaml
  tests:
    -
      test_title: geoip rules test
      stages:
        -
          stage:
            debug: true
            input:
              dest_addr: "81.2.69.142"
            output:
              triggered_rules:
                - 1
                - 3
                - 4
                - 5
                - 7
              non_triggered_rules:
                - 2
                - 6
  rules: |
    SecGeoLookupDb maxminddb ../testdata/geoip_db/GeoLite2-City.mmdb
    SecRule SERVER_ADDR "@geoLookup" "chain,id:1,log,phase:1"
    SecRule GEO:COUNTRY_CODE "@streq GB"
    
    SecRule SERVER_ADDR "@geoLookup" "chain,id:2,log,phase:1"
    SecRule GEO:COUNTRY_NAME "!@streq United Kingdom"
    
    SecGeoLookupDb maxminddb ../testdata/geoip_db/GeoLite2-City.mmdb
    SecRule SERVER_ADDR "@geoLookup" "chain,id:3,log,phase:1"
    SecRule GEO:COUNTRY_CONTINENT "!@streq europe"
    
    SecRule SERVER_ADDR "@geoLookup" "chain,id:4,log,phase:1"
    SecRule GEO:CITY "@streq Chingford"
    
    SecRule SERVER_ADDR "@geoLookup" "chain,id:5,log,phase:1"
    SecRule GEO:POSTAL_CODE "@streq E4"
    
    SecRule SERVER_ADDR "@geoLookup" "chain,id:6,log,phase:1"
    SecRule GEO:LATITUDE "@lt 50"
    
    SecRule SERVER_ADDR "@geoLookup" "chain,id:7,log,phase:1"
    SecRule GEO:LONGITUDE "@gt -20"